var t={},e="idle",n="playing",s={num:()=>.9>=Math.random()?2:4,position(t){let e=Math.floor(4*Math.random());for(;!t[e].includes(0);)e=Math.floor(4*Math.random());let n=Math.floor(4*Math.random());for(;0!==t[e][n];)n=Math.floor(4*Math.random());return[e,n]}},i=t=>{let e=t.map(t=>[...t]),n=s.num(),[i,l]=s.position(e);return e[i][l]=n,e},l=()=>{let t=i([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]);return i(t)},r=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=[t.length-1,t[t.length-1][n]],i=null;for(let l=t.length-1;l>=0;l-=1){let r=t[l][n];if(0===r){if(null!==i)continue;i=l;continue}if(s[1]===r&&s[0]!==l){t[s[0]][n]=2*r,t[l][n]=0,i=l,s[0]-=1,l+=1,s[1]=t[s[0]][n],e=!1;continue}if(null!==i){t[i][n]=r,s[0]=i,s[1]=r,i-=1,t[l][n]=0,e=!1;continue}if(s[1]!==r){s[0]-=1,s[1]=r;continue}}}return!e&&t},o=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=t[n],i=[0,s[0]],l=null;for(let r=0;r<s.length;r+=1){let o=s[r];if(0===o){if(null!==l)continue;l=r;continue}if(i[1]===o&&i[0]!==r){t[n][i[0]]=2*o,t[n][r]=0,l=r,i[0]+=1,r-=1,i[1]=t[r][i[0]],e=!1;continue}if(null!==l){t[n][l]=o,i[0]=l,i[1]=o,l+=1,t[n][r]=0,e=!1;continue}if(i[1]!==o){i[0]+=1,i[1]=o;continue}}}return!e&&t},a=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=t[n],i=[s.length-1,s[s.length-1]],l=null;for(let r=s.length-1;r>=0;r-=1){let o=s[r];if(0===o){if(null!==l)continue;l=r;continue}if(i[1]===o&&i[0]!==r){t[n][i[0]]=2*o,t[n][r]=0,l=r,i[0]-=1,r+=1,i[1]=t[r][i[0]],e=!1;continue}if(null!==l){t[n][l]=o,i[0]=l,i[1]=o,l-=1,t[n][r]=0,e=!1;continue}if(i[1]!==o){i[0]-=1,i[1]=o;continue}}}return!e&&t},c=t=>{let e=!0;for(let n=0;n<t.length;n+=1){let s=[0,t[0][n]],i=null;for(let l=0;l<t.length;l+=1){let r=t[l][n];if(0===r){if(null!==i)continue;i=l;continue}if(s[1]===r&&s[0]!==l){t[s[0]][n]=2*r,t[l][n]=0,i=l,s[0]+=1,l-=1,s[1]=t[s[0]][n],e=!1;continue}if(null!==i){t[i][n]=r,s[0]=i,s[1]=r,i+=1,t[l][n]=0,e=!1;continue}if(s[1]!==r){s[0]+=1,s[1]=r;continue}}}return!e&&t},u=t=>{[...document.querySelector("tbody").children].forEach((e,n)=>{[...e.children].forEach((e,s)=>{if(e.children.length)e.lastChild.classList.add("hide"),new Promise(t=>{setTimeout(()=>t(),75)}).then(()=>{e.removeChild(e.lastChild);let i=document.createElement("div");i.classList.add("field-cell"),i.style.cssText="display: flex; justify-content: center; align-items: center;";let l=t[n][s];l&&i.classList.add(`field-cell--${l}`),i.textContent=0===l?"":l,e.append(i)});else{let i=document.createElement("div");i.classList.add("field-cell"),i.style.cssText="display: flex; justify-content: center; align-items: center;";let l=t[n][s];l&&i.classList.add(`field-cell--${l}`),i.textContent=0===l?"":l,e.append(i)}})})};t=class{state=[];status=e;constructor(t){this.state=t}moveLeft(){if(this.getStatus()!==n)return;let t=o(this.getState());this.applyChanges(t)}moveRight(){if(this.getStatus()!==n)return;let t=a(this.getState());this.applyChanges(t)}moveUp(){if(this.getStatus()!==n)return;let t=c(this.getState());this.applyChanges(t)}moveDown(){if(this.getStatus()!==n)return;let t=r(this.getState());this.applyChanges(t)}getScore(){return this.status===e?0:this.state.flat().reduce((t,e)=>t+e,0)}getState(){return this.state.map(t=>[...t])}getStatus(){return this.status}start(){this.status=n,u(this.getState())}restart(){this.state=l(),u(this.getState()),this.status=n,document.querySelectorAll(".message").forEach(t=>{t.classList.contains("hidden")||t.classList.add("hidden")})}async applyChanges(t){if(await this.isFull(t)){this.gameOver();return}if(!t)return;let e=i(t);this.state=e,u(e),this.has2048(this.state)&&this.winner()}isFull(t){if(!t)return new Promise((t,e)=>{if(a(this.getState()))return!1;t()}).then(()=>{if(o(this.getState()))return!1}).then(()=>{if(c(this.getState()))return!1}).then(()=>!r(this.getState()))}gameOver(){this.status="lose",document.querySelector(".message-lose").classList.remove("hidden")}has2048(t){return t.flat().includes(2048)}winner(){this.status="win",document.querySelector(".message-win").classList.remove("hidden")}};const h=document.querySelector(".controls button"),d=document.querySelector(".game-score"),f=new t(l());document.body.style.overflowY="hidden",h.addEventListener("click",()=>{h.classList.contains("start")?(h.classList.remove("start"),h.classList.add("restart"),h.textContent="Restart",f.start()):f.restart(),document.querySelector(".message-start").classList.add("hidden");let t=f.getScore();d.textContent=t}),document.addEventListener("keydown",t=>{if("ArrowRight"===t.key){f.moveRight();let t=f.getScore();d.textContent=t}if("ArrowLeft"===t.key){f.moveLeft();let t=f.getScore();d.textContent=t}if("ArrowUp"===t.key){f.moveUp();let t=f.getScore();d.textContent=t}if("ArrowDown"===t.key){f.moveDown();let t=f.getScore();d.textContent=t}}),(t=>{let e=document.querySelector("tbody"),n=document.querySelector(".game-score"),s=0,i=0,l=0,r=0;return e.addEventListener("touchstart",t=>{s=t.changedTouches[0].screenX,l=t.changedTouches[0].screenY}),e.addEventListener("touchend",e=>{i=e.changedTouches[0].screenX,r=e.changedTouches[0].screenY,function(){Math.abs(s-i)>Math.abs(l-r)?(s-i>20&&t.moveLeft(),i-s>20&&t.moveRight()):(l-r>20&&t.moveUp(),r-l>20&&t.moveDown());let e=t.getScore();n.textContent=e}()}),()=>{e.removeEventListener("touchstart",touchStartHandler),e.removeEventListener("touchend",touchEndHandler)}})(f);
//# sourceMappingURL=index.dafbb4db.js.map
